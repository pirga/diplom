exec sp_MSforeachtable "declare @Name nvarchar(max); set @Name = parseName('?', 1); exec sp_MSdropconstraints @Name";
exec sp_MSforeachtable "drop table ?";

IF OBJECT_Id('Category', N'U') IS NOT NULL
BEGIN
	DROP TABLE Category;
END
IF OBJECT_Id('Role', N'U') IS NOT NULL
BEGIN
	DROP TABLE Role;
END
IF OBJECT_Id('Brand', N'U') IS NOT NULL
BEGIN
	DROP TABLE Brand;
END
IF OBJECT_Id('Product', N'U') IS NOT NULL
BEGIN
	DROP TABLE Product;
END
IF OBJECT_Id('Tag', N'U') IS NOT NULL
BEGIN
	DROP TABLE Tag;
END
IF OBJECT_Id('Product_category', N'U') IS NOT NULL
BEGIN
	DROP TABLE Product_category;
END
IF OBJECT_Id('Product_brand', N'U') IS NOT NULL
BEGIN
	DROP TABLE Product_brand;
END
IF OBJECT_Id('Product_image', N'U') IS NOT NULL
BEGIN
	DROP TABLE Product_image;
END
IF OBJECT_Id('Product_tag', N'U') IS NOT NULL
BEGIN
	DROP TABLE Product_tag;
END
IF OBJECT_Id('Users', N'U') IS NOT NULL
BEGIN
	DROP TABLE Users;
END
IF OBJECT_Id('Comment', N'U') IS NOT NULL
BEGIN
	DROP TABLE Comment;
END
IF OBJECT_Id('Basket', N'U') IS NOT NULL
BEGIN
	DROP TABLE Basket;
END
IF OBJECT_Id('Orders', N'U') IS NOT NULL
BEGIN
	DROP TABLE Orders;
END




IF OBJECT_Id('Category', N'U') IS NULL
BEGIN
	CREATE TABLE Category
	(
		Id INT NOT NULL PRIMARY KEY IDENTITY(1,1),
		Id_parent INT NULL,
		Name NVARCHAR(255) UNIQUE NOT NULL,
	);
END

IF OBJECT_Id('Role', N'U') IS NULL
BEGIN
	CREATE TABLE Role
	(
		Id INT NOT NULL PRIMARY KEY IDENTITY(1,1),
		Name NVARCHAR(255) UNIQUE NOT NULL,
	);
END

IF OBJECT_Id('Brand', N'U') IS NULL
BEGIN
	CREATE TABLE Brand
	(
		Id INT NOT NULL PRIMARY KEY IDENTITY(1,1),
		Id_category INT NOT NULL,
		Name NVARCHAR(255) UNIQUE NOT NULL,
		Short_info NVARCHAR(255) NULL,
		FOREIGN KEY (Id_category) REFERENCES Category(Id) ON DELETE CASCADE ON UPDATE CASCADE
	);
END

IF OBJECT_Id('Product', N'U') IS NULL
BEGIN
	CREATE TABLE Product
	(
		Id INT NOT NULL PRIMARY KEY IDENTITY(1,1),
		Date_add DATETIME DEFAULT GETDATE() NOT NULL,
		Name NVARCHAR(255) UNIQUE NOT NULL,
		Description NTEXT NOT NULL,
		Price INT NOT NULL,
		Count INT NOT NULL,		
		Photo NTEXT NOT NULL,
	);
END

IF OBJECT_Id('Tag', N'U') IS NULL
BEGIN
	CREATE TABLE Tag
	(
		Id INT NOT NULL PRIMARY KEY IDENTITY(1,1),
		Name NVARCHAR(255) UNIQUE NOT NULL,
	);
END

IF OBJECT_Id('Product_category', N'U') IS NULL
BEGIN
	CREATE TABLE Product_category
	(
		Id INT NOT NULL PRIMARY KEY IDENTITY(1,1),
		Id_product int,
		Id_category int,
		FOREIGN KEY (Id_product) REFERENCES Product(Id) ON DELETE CASCADE ON UPDATE CASCADE,
		FOREIGN KEY (Id_category) REFERENCES Category(Id) ON DELETE CASCADE ON UPDATE CASCADE
	);
END

IF OBJECT_Id('Product_brand', N'U') IS NULL
BEGIN
	CREATE TABLE Product_brand
	(
		Id INT NOT NULL PRIMARY KEY IDENTITY(1,1),
		Id_product int,
		Id_brand int,
		FOREIGN KEY (Id_product) REFERENCES Product(Id) ON DELETE CASCADE ON UPDATE CASCADE,
		FOREIGN KEY (Id_brand) REFERENCES Brand(Id) ON DELETE CASCADE ON UPDATE CASCADE
	);
END

IF OBJECT_Id('Product_tag', N'U') IS NULL
BEGIN
	CREATE TABLE Product_tag
	(
		Id INT NOT NULL PRIMARY KEY IDENTITY(1,1),
		Id_product int,
		Id_tag int,
		FOREIGN KEY (Id_product) REFERENCES Product(Id) ON DELETE CASCADE ON UPDATE CASCADE,
		FOREIGN KEY (Id_tag) REFERENCES Tag(Id) ON DELETE CASCADE ON UPDATE CASCADE
	);
END

IF OBJECT_Id('Product_image', N'U') IS NULL
BEGIN
	CREATE TABLE Product_image
	(
		Id INT NOT NULL PRIMARY KEY IDENTITY(1,1),
		Id_product int,
		Photo NTEXT,
		FOREIGN KEY (Id_product) REFERENCES Product(Id) ON DELETE CASCADE ON UPDATE CASCADE,
	);
END

IF OBJECT_Id('Users', N'U') IS NULL
BEGIN
	CREATE TABLE Users
	(
		Id INT NOT NULL PRIMARY KEY IDENTITY(1,1),		
		Date_reg DATETIME DEFAULT GETDATE() NOT NULL,
		Id_Role INT NOT NULL,
		State NVARCHAR(255) NOT NULL,
		Fio NVARCHAR(255) NOT NULL,
		Login NVARCHAR(255) UNIQUE NOT NULL,
		Email NVARCHAR(255) UNIQUE NOT NULL,
		Password NVARCHAR(255) NOT NULL,
		Phone NVARCHAR(255) NOT NULL,
		Address NVARCHAR(255) NOT NULL,
		City NVARCHAR(255) NOT NULL,
		Country NVARCHAR(255) NOT NULL,
		Number_credit_card NVARCHAR(255) NOT NULL,
		Short_info NVARCHAR(255) NULL,
		Photo NTEXT NOT NULL,
		FOREIGN KEY (Id_Role) REFERENCES Role(Id) ON DELETE CASCADE ON UPDATE CASCADE
	);
END

IF OBJECT_Id('Comment', N'U') IS NULL
BEGIN
	CREATE TABLE Comment
	(
		Id INT NOT NULL PRIMARY KEY IDENTITY(1,1),
		Date_add DATETIME DEFAULT GETDATE() NOT NULL,
		Id_product INT NOT NULL,
		Id_user INT NOT NULL,
		Text NTEXT NOT NULL,
		FOREIGN KEY (Id_product) REFERENCES Product(Id) ON DELETE CASCADE ON UPDATE CASCADE,
		FOREIGN KEY (Id_user) REFERENCES Users(Id) ON DELETE CASCADE ON UPDATE CASCADE
	);
END

IF OBJECT_Id('Basket', N'U') IS NULL
BEGIN
	CREATE TABLE Basket
	(
		Id INT NOT NULL PRIMARY KEY IDENTITY(1,1),
		Id_product INT NOT NULL,
		Id_user INT NOT NULL,
		Count INT NOT NULL,
		FOREIGN KEY (Id_product) REFERENCES Product(Id) ON DELETE CASCADE ON UPDATE CASCADE,
		FOREIGN KEY (Id_user) REFERENCES Users(Id) ON DELETE CASCADE ON UPDATE CASCADE
	);
END

IF OBJECT_Id('Orders', N'U') IS NULL
BEGIN
	CREATE TABLE Orders
	(
		Id INT NOT NULL PRIMARY KEY IDENTITY(1,1),
		Date_start DATETIME DEFAULT GETDATE() NOT NULL,
		Date_shop DATETIME DEFAULT GETDATE() NOT NULL,
		State NVARCHAR(255) NOT NULL,
		Id_product INT NOT NULL,
		Id_user INT NOT NULL,
		Count INT NOT NULL,
		Comment NTEXT NULL,
		FOREIGN KEY (Id_product) REFERENCES Product(Id) ON DELETE CASCADE ON UPDATE CASCADE,
		FOREIGN KEY (Id_user) REFERENCES Users(Id) ON DELETE CASCADE ON UPDATE CASCADE
	);
END

INSERT INTO Category VALUES(NULL,'Name');

INSERT INTO Role VALUES('Name');

INSERT INTO Brand VALUES(1,'Name BRAND','SHORT DESCRIPTION');

INSERT INTO Product VALUES('2018.04.03','Name','DESCRIPTION',200,15,'PATH TO PHOTO');

INSERT INTO Tag VALUES('Tag 1');

INSERT INTO Product_category VALUES(1,1);

INSERT INTO Product_brand VALUES(1,1);

INSERT INTO Product_tag VALUES(1,1);

INSERT INTO Product_image VALUES(1,'path to image');

INSERT INTO Users VALUES('2018.04.03',1,'NOT BAN','Name','LOGIN','EMAIL','PASSWORD','PHONE_MOBILE','ADDRESS','City','Country','12345678912345','SHORT INFO','PHOTO PATH');

INSERT INTO Comment VALUES('2018.04.03',1,1,'TEXT COMMENT');

INSERT INTO Basket VALUES(1,1,10);

INSERT INTO Orders VALUES('2018.04.03','2018.04.03','STATUS',1,1,10,'comment');

SELECT * FROM Category;
SELECT * FROM Role;
SELECT * FROM Brand;
SELECT * FROM Product;
SELECT * FROM Tag;
SELECT * FROM Product_category;
SELECT * FROM Product_brand;
SELECT * FROM Product_tag;
SELECT * FROM Product_image;
SELECT * FROM Users;
SELECT * FROM Comment;
SELECT * FROM Basket;
SELECT * FROM Orders;


